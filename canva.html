<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Netflix-Style Drawing Canvas</title>

  <!-- Bootstrap / Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <style>
    /* ===============================
       Fonts
    ================================= */
    @font-face{
      font-family:'BMHANNAPro';
      src:url('/fonts/BMHANNAPro.ttf') format('truetype');
      font-display:swap;
    }

    /* ===============================
       Global Scrollbar Hide (keeps scroll behavior)
    ================================= */
    /* Firefox */
    * { scrollbar-width: none; }
    /* IE/Legacy Edge */
    * { -ms-overflow-style: none; }
    /* WebKit (Chrome/Safari/New Edge/Opera) */
    *::-webkit-scrollbar { display:none; width:0; height:0; }

    html,body{ height:100%; }

    /* ===============================
       Netflix-ish Theme (Dark)
    ================================= */
    :root{
      --nfx-red:#E50914;
      --ink:#e5e7eb;
      --muted:#cbd5e1;
      --bg1:#0b0b0d;
      --bg2:#111113;
      --tile:#171922;
      --ring:rgba(255,255,255,.14);
      --shadow:0 22px 60px rgba(0,0,0,.55);
    }

    body{
      min-height:100vh;
      margin:0;
      padding:0;
      font-family:"BMHANNAPro",'Noto Sans KR',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 50% -10%, rgba(229,9,20,.16), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 60%, var(--bg1) 100%);
      overflow-x:hidden;
    }

    /* ===============================
       Navbar (glass on scroll)
    ================================= */
    .navbar{
      position:sticky; top:0; z-index:1040;
      background:transparent !important;
      transition:background .25s ease, border-color .25s ease;
      border-bottom:1px solid transparent;
    }
    .navbar.nav-solid{
      background:rgba(17,17,19,.86)!important; backdrop-filter: blur(8px);
      border-bottom-color: rgba(255,255,255,.08);
    }
    .navbar .navbar-brand, .navbar .nav-link{ color:#f3f4f6 !important; }
    .btn-primary{ background:var(--nfx-red); border-color:var(--nfx-red); }
    .btn-primary:hover{ background:#bd0812; border-color:#bd0812; }

    /* ===============================
       Canvas Shell
    ================================= */
    .drawing-container{
      max-width:1200px;
      margin:0 auto;
      padding:24px 20px 20px;
    }

    #toolbar{
      background: rgba(17,17,19,.9);
      color:#f3f4f6;
      backdrop-filter: blur(10px);
      border-radius:16px;
      padding:20px;
      margin-bottom:20px;
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,.08);
    }

    .tool-section{
      display:flex; align-items:center; gap:15px;
      margin-bottom:15px; flex-wrap:wrap;
    }
    .tool-section:last-child{ margin-bottom:0; }

    .tool-label{ font-weight:800; color:#fff; min-width:80px; letter-spacing:.02em; }

    .tool-buttons{ display:flex; gap:10px; flex-wrap:wrap; }

    /* Canvas */
    canvas{
      border-radius:14px;
      box-shadow:0 18px 42px rgba(0,0,0,.6);
      background-color:#0f1116;
      border:1px solid rgba(255,255,255,.10);
      cursor:crosshair;
      display:block;
      margin:0 auto;
    }

    /* Tool Buttons */
    .btn-tool{
      padding:8px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#f3f4f6;
      transition: all .25s ease;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(0,0,0,.25) inset;
    }
    .btn-tool:hover{ transform: translateY(-2px); background:rgba(255,255,255,.12); }
    .btn-tool.active{
      background:linear-gradient(135deg, #f43f5e 0%, #ef4444 50%, #E50914 100%);
      border-color:rgba(255,255,255,.22);
      color:#fff;
      box-shadow:0 12px 24px rgba(229,9,20,.35);
    }

    .color-preset{
      width:34px; height:34px; border-radius:50%;
      cursor:pointer; border:3px solid transparent; transition: all .25s ease;
      box-shadow:0 4px 10px rgba(0,0,0,.25);
    }
    .color-preset:hover{ transform:scale(1.08); }
    .color-preset.active{ border-color:#fff; box-shadow:0 0 0 3px rgba(255,255,255,.18), 0 10px 18px rgba(0,0,0,.35); }

    #colorPicker{
      width:54px; height:34px; border:none; border-radius:8px; cursor:pointer;
      background:transparent;
      box-shadow:0 4px 10px rgba(0,0,0,.25);
    }

    .line-preview{
      width:110px; height:30px; background: rgba(255,255,255,.06);
      border-radius:8px; display:flex; align-items:center; justify-content:center;
      border:1px solid rgba(255,255,255,.10);
    }
    .line-preview-stroke{ width:80%; background:#fff; border-radius:10px; transition:all .3s; }

    input[type="range"]{ width:170px; }

    .canvas-info{
      background: rgba(17,17,19,.9);
      color:#f3f4f6;
      padding:10px 15px; border-radius:12px; margin-top:15px;
      display:flex; justify-content:space-between; align-items:center;
      border:1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
    }

    .history-controls{ display:flex; gap:10px; }

    /* Footer */
    footer.bg-body-tertiary{
      background: rgba(17,17,19,.86)!important; backdrop-filter: blur(6px);
      border-top:1px solid rgba(255,255,255,.08);
      color:#cbd5e1 !important;
    }
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">건재이조의 취미생활</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
              aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="canva.html">Canvas</a></li>
          <li class="nav-item"><a class="nav-link" href="video.html">Video</a></li>
          <li class="nav-item"><a class="nav-link" href="music.html">Music</a></li>
          <li class="nav-item"><a class="nav-link" href="kanban-board.html">Kanban</a></li>
          <li class="nav-item"><a class="nav-link" href="CafeMap.html">Map</a></li>
        </ul>
        <div class="d-flex gap-2 align-items-center">
          <!-- 다크모드 토글 제거됨 -->
          <a class="btn btn-primary btn-sm" href="signup.html">회원가입</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Canvas App -->
  <div class="drawing-container">
    <!-- Toolbar -->
    <div id="toolbar">
      <div class="tool-section">
        <span class="tool-label">도구:</span>
        <div class="tool-buttons">
          <button class="btn-tool active" data-tool="pen"><i class="fas fa-pen"></i> 펜</button>
          <button class="btn-tool" data-tool="eraser"><i class="fas fa-eraser"></i> 지우개</button>
          <button class="btn-tool" data-tool="line"><i class="fas fa-minus"></i> 직선</button>
          <button class="btn-tool" data-tool="rect"><i class="far fa-square"></i> 사각형</button>
          <button class="btn-tool" data-tool="circle"><i class="far fa-circle"></i> 원</button>
          <button class="btn-tool" data-tool="text"><i class="fas fa-font"></i> 텍스트</button>
        </div>
      </div>

      <div class="tool-section">
        <span class="tool-label">색상:</span>
        <div class="tool-buttons">
          <div class="color-preset active" style="background:#000000" data-color="#000000"></div>
          <div class="color-preset" style="background:#ff0000" data-color="#FF0000"></div>
          <div class="color-preset" style="background:#00ff00" data-color="#00FF00"></div>
          <div class="color-preset" style="background:#0000ff" data-color="#0000FF"></div>
          <div class="color-preset" style="background:#ffff00" data-color="#FFFF00"></div>
          <div class="color-preset" style="background:#ff00ff" data-color="#FF00FF"></div>
          <div class="color-preset" style="background:#00ffff" data-color="#00FFFF"></div>
          <input type="color" id="colorPicker" value="#000000"/>
        </div>
      </div>

      <div class="tool-section">
        <span class="tool-label">두께:</span>
        <input type="range" id="lineWidth" min="1" max="50" value="3"/>
        <div class="line-preview"><div class="line-preview-stroke" style="height:3px"></div></div>
        <span id="lineWidthValue">3px</span>
      </div>

      <div class="tool-section">
        <span class="tool-label">액션:</span>
        <div class="tool-buttons">
          <button class="btn-tool" id="clearBtn"><i class="fas fa-trash"></i> 전체 지우기</button>
          <button class="btn-tool" id="fillBtn"><i class="fas fa-fill-drip"></i> 배경 채우기</button>
          <label for="imageUpload" class="btn-tool" style="margin:0">
            <i class="fas fa-image"></i> 이미지 불러오기
            <input type="file" id="imageUpload" accept="image/*" style="display:none"/>
          </label>
          <button class="btn-tool" id="saveBtn"><i class="fas fa-download"></i> 저장하기</button>
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <canvas id="myCanvas" width="1100" height="600"></canvas>

    <div class="canvas-info">
      <div class="history-controls">
        <button class="btn btn-sm btn-secondary" id="undoBtn" disabled><i class="fas fa-undo"></i> 되돌리기</button>
        <button class="btn btn-sm btn-secondary" id="redoBtn" disabled><i class="fas fa-redo"></i> 앞돌리기</button>
      </div>
      <small id="canvasStatus">준비됨</small>
    </div>
  </div>

  <!-- Footer -->
  <footer class="mt-auto py-4 bg-body-tertiary text-center small text-body-secondary">
    © <span id="year"></span> Team 건재이조
  </footer>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Navbar solid on scroll
    const nav = document.querySelector('.navbar');
    const onScroll = ()=> nav.classList.toggle('nav-solid', window.scrollY > 24);
    onScroll(); window.addEventListener('scroll', onScroll);

    // ===== Canvas App (no dark-mode code) =====
    const canvas = document.getElementById("myCanvas");
    const ctx = canvas.getContext("2d");
    const colorPicker = document.getElementById("colorPicker");
    const lineWidthInput = document.getElementById("lineWidth");
    const lineWidthValue = document.getElementById("lineWidthValue");
    const imageUpload = document.getElementById("imageUpload");
    const saveBtn = document.getElementById("saveBtn");
    const clearBtn = document.getElementById("clearBtn");
    const fillBtn = document.getElementById("fillBtn");
    const undoBtn = document.getElementById("undoBtn");
    const redoBtn = document.getElementById("redoBtn");
    const canvasStatus = document.getElementById("canvasStatus");
    const linePreviewStroke = document.querySelector(".line-preview-stroke");

    let drawing = false;
    let currentTool = "pen";
    let currentColor = "#000000";
    let currentLineWidth = 3;
    let startX, startY;
    let history = [];
    let historyStep = -1;
    let isModified = false;

    function initCanvas(){
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      saveState();
    }

    function saveState(){
      historyStep++;
      if (historyStep < history.length) history.length = historyStep;
      history.push(canvas.toDataURL());
      updateHistoryButtons();
    }

    function updateHistoryButtons(){
      undoBtn.disabled = historyStep <= 0;
      redoBtn.disabled = historyStep >= history.length - 1;
    }

    undoBtn.addEventListener("click", ()=>{
      if(historyStep > 0){
        historyStep--;
        const img = new Image();
        img.src = history[historyStep];
        img.onload = ()=>{
          ctx.clearRect(0,0,canvas.width,canvas.height);
          ctx.drawImage(img,0,0);
          updateHistoryButtons();
          canvasStatus.textContent = "되돌리기 완료";
        };
      }
    });

    redoBtn.addEventListener("click", ()=>{
      if(historyStep < history.length - 1){
        historyStep++;
        const img = new Image();
        img.src = history[historyStep];
        img.onload = ()=>{
          ctx.clearRect(0,0,canvas.width,canvas.height);
          ctx.drawImage(img,0,0);
          updateHistoryButtons();
          canvasStatus.textContent = "다시하기 완료";
        };
      }
    });

    // Tools
    document.querySelectorAll("[data-tool]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll("[data-tool]").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        currentTool = btn.dataset.tool;
        canvas.style.cursor = currentTool === "text" ? "text" : "crosshair";
        canvasStatus.textContent = `${btn.textContent.trim()} 도구 선택됨`;
      });
    });

    // Color presets
    document.querySelectorAll(".color-preset").forEach(preset=>{
      preset.addEventListener("click", ()=>{
        document.querySelectorAll(".color-preset").forEach(p=>p.classList.remove("active"));
        preset.classList.add("active");
        currentColor = preset.dataset.color;
        colorPicker.value = currentColor;
        linePreviewStroke.style.background = currentColor;
      });
    });

    // Color picker
    colorPicker.addEventListener("input", e=>{
      currentColor = e.target.value;
      document.querySelectorAll(".color-preset").forEach(p=>p.classList.remove("active"));
      linePreviewStroke.style.background = currentColor;
    });

    // Line width
    lineWidthInput.addEventListener("input", e=>{
      currentLineWidth = e.target.value;
      lineWidthValue.textContent = `${currentLineWidth}px`;
      linePreviewStroke.style.height = `${Math.min(currentLineWidth, 20)}px`;
    });

    // Clear
    clearBtn.addEventListener("click", ()=>{
      if(confirm("정말로 전체를 지우시겠습니까?")){
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        saveState();
        isModified = false;
        canvasStatus.textContent = "캔버스가 초기화되었습니다";
      }
    });

    // Fill
    fillBtn.addEventListener("click", ()=>{
      ctx.fillStyle = currentColor;
      ctx.fillRect(0,0,canvas.width,canvas.height);
      saveState();
      isModified = true;
      canvasStatus.textContent = "배경이 채워졌습니다";
    });

    // Mouse draw
    canvas.addEventListener("mousedown", (e)=>{
      drawing = true;
      startX = e.offsetX; startY = e.offsetY;

      if (currentTool === "pen" || currentTool === "eraser"){
        ctx.beginPath();
        ctx.moveTo(startX, startY);
      } else if (currentTool === "text"){
        const text = prompt("텍스트를 입력하세요:");
        if (text){
          ctx.font = `${currentLineWidth * 5}px Arial`;
          ctx.fillStyle = currentColor;
          ctx.fillText(text, startX, startY);
          saveState();
          isModified = true;
        }
        drawing = false;
      }
    });

    canvas.addEventListener("mousemove", (e)=>{
      if(!drawing) return;
      const x = e.offsetX, y = e.offsetY;

      if (currentTool === "pen"){
        ctx.globalCompositeOperation = "source-over";
        ctx.lineTo(x, y);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentLineWidth;
        ctx.lineCap = "round"; ctx.lineJoin = "round";
        ctx.stroke();
      } else if (currentTool === "eraser"){
        ctx.globalCompositeOperation = "destination-out";
        ctx.lineTo(x, y);
        ctx.lineWidth = currentLineWidth * 2;
        ctx.lineCap = "round"; ctx.lineJoin = "round";
        ctx.stroke();
      }
    });

    canvas.addEventListener("mouseup", (e)=>{
      if(!drawing) return;
      const endX = e.offsetX, endY = e.offsetY;
      ctx.globalCompositeOperation = "source-over";

      if (currentTool === "line"){
        ctx.beginPath();
        ctx.moveTo(startX,startY);
        ctx.lineTo(endX,endY);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentLineWidth;
        ctx.stroke();
      } else if (currentTool === "rect"){
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentLineWidth;
        ctx.strokeRect(startX, startY, endX - startX, endY - startY);
      } else if (currentTool === "circle"){
        const radius = Math.hypot(endX - startX, endY - startY);
        ctx.beginPath();
        ctx.arc(startX, startY, radius, 0, Math.PI*2);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentLineWidth;
        ctx.stroke();
      }

      drawing = false;
      saveState();
      isModified = true;
      canvasStatus.textContent = "그리기 완료";
    });

    canvas.addEventListener("mouseleave", ()=>{ drawing = false; });

    // Touch support
    canvas.addEventListener("touchstart", (e)=>{
      e.preventDefault();
      const t = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const evt = new MouseEvent("mousedown", { clientX: t.clientX - rect.left, clientY: t.clientY - rect.top });
      canvas.dispatchEvent(evt);
    }, {passive:false});

    canvas.addEventListener("touchmove", (e)=>{
      e.preventDefault();
      const t = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const evt = new MouseEvent("mousemove", { clientX: t.clientX - rect.left, clientY: t.clientY - rect.top });
      canvas.dispatchEvent(evt);
    }, {passive:false});

    canvas.addEventListener("touchend", (e)=>{
      e.preventDefault();
      canvas.dispatchEvent(new MouseEvent("mouseup", {}));
    }, {passive:false});

    // Image upload
    imageUpload.addEventListener("change", (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev)=>{
        const img = new Image();
        img.onload = ()=>{
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          saveState();
          isModified = true;
          canvasStatus.textContent = "이미지가 로드되었습니다";
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // Save
    saveBtn.addEventListener("click", ()=>{
      if(!isModified){ alert("저장할 내용이 없습니다!"); return; }
      const link = document.createElement("a");
      const now = new Date();
      const ts = now.toISOString().slice(0,19).replace(/[:.]/g,"-");
      link.download = `drawing_${ts}.png`;
      link.href = canvas.toDataURL("image/png");
      link.click();
      canvasStatus.textContent = "이미지가 저장되었습니다";
    });

    // Init
    initCanvas();
  </script>
</body>
</html>
